---
import Layout from '../layouts/Layout.astro';
import '../styles/global.css'; // IGNORE
import { useStoryblokApi } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import { getComponent } from '../utils/getcomponent';
import type { StoryblokMeta } from '../types/StoryblokMeta';
import type { StoryblokHeader } from '../types/StoryblokHeader';
import isPreview from '../utils/isPreview';


const storyblokApi = useStoryblokApi()
const { data } = await storyblokApi.get('cdn/stories/home', {
  version: isPreview() ? 'draft' : 'published',

})

const story = data.story
const { content } = story
const meta: StoryblokMeta = (getComponent('meta', content.Header) as StoryblokMeta);
const header: StoryblokHeader = (getComponent('header', content.Header) as StoryblokHeader);
---

<Layout meta={meta} header={header}>
    {content?.body.length > 0 ? content?.body.map((component: any) => <StoryblokComponent blok={component} /> ): null}
</Layout>
